{% extends "base.html" %}

{% block title %}Candidate Details - {{ CLUB_NAME }}{% endblock %}

{% block content %}
<div class="mb-3 d-flex justify-content-between align-items-center">
    <a href="{{ url_for('admin.candidates') }}" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> Back to Candidates
    </a>
    <div class="btn-group">
        <a href="{{ url_for('admin.edit_candidate', user_id=candidate.id) }}" class="btn btn-warning">
            <i class="bi bi-pencil"></i> Edit
        </a>
        <button type="button" class="btn btn-danger" 
                onclick="confirmDelete({{ candidate.id }}, '{{ candidate.name }}', '{{ candidate.email }}')">
            <i class="bi bi-trash"></i> Delete
        </button>
    </div>
</div>

<h1 class="mb-4"><i class="bi bi-person"></i> Candidate Details</h1>

<div class="row">
    <div class="col-md-8">
        <!-- Candidate Info -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Personal Information</h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-4"><strong>Name:</strong></div>
                    <div class="col-md-8">{{ candidate.name }}</div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-4"><strong>Email:</strong></div>
                    <div class="col-md-8">{{ candidate.email }}</div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-4"><strong>Phone:</strong></div>
                    <div class="col-md-8">{{ candidate.phone or 'N/A' }}</div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-4"><strong>Registered:</strong></div>
                    <div class="col-md-8">{{ candidate.created_at.strftime('%Y-%m-%d %H:%M') }}</div>
                </div>
            </div>
        </div>

        <!-- Application Info -->
        {% if candidate.application %}
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">Application Details</h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-4"><strong>Department:</strong></div>
                    <div class="col-md-8">{{ candidate.application.department }}</div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-4"><strong>Year:</strong></div>
                    <div class="col-md-8">{{ candidate.application.year }}</div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-4"><strong>Skills:</strong></div>
                    <div class="col-md-8">{{ candidate.application.skills or 'N/A' }}</div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-4"><strong>Status:</strong></div>
                    <div class="col-md-8">
                        {% if candidate.application.status == 'pending' %}
                        <span class="badge bg-warning">Pending</span>
                        {% elif candidate.application.status == 'slot_selected' %}
                        <span class="badge bg-info">Slot Selected</span>
                        {% elif candidate.application.status == 'interviewed' %}
                        <span class="badge bg-primary">Interviewed</span>
                        {% elif candidate.application.status == 'selected' %}
                        <span class="badge bg-success">Selected</span>
                        {% elif candidate.application.status == 'rejected' %}
                        <span class="badge bg-danger">Rejected</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Slot Booking -->
        {% if candidate.slot_booking %}
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">Interview Slot</h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-4"><strong>Date:</strong></div>
                    <div class="col-md-8">{{ candidate.slot_booking.slot.date.strftime('%A, %B %d, %Y') }}</div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-4"><strong>Time:</strong></div>
                    <div class="col-md-8">
                        {{ candidate.slot_booking.slot.start_time.strftime('%I:%M %p') }} - 
                        {{ candidate.slot_booking.slot.end_time.strftime('%I:%M %p') }}
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-4"><strong>Booked At:</strong></div>
                    <div class="col-md-8">{{ candidate.slot_booking.booked_at.strftime('%Y-%m-%d %H:%M') }}</div>
                </div>
            </div>
        </div>
        {% endif %}
        {% endif %}
    </div>

    <div class="col-md-4">
        <!-- Update Status -->
        <div class="card">
            <div class="card-header bg-warning">
                <h5 class="mb-0">Update Status</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('admin.update_candidate_status', user_id=candidate.id) }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    
                    <div class="mb-3">
                        <label for="status" class="form-label">Application Status</label>
                        <select class="form-select" id="status" name="status" required>
                            {% set current_status = candidate.application.status if candidate.application else 'pending' %}
                            <option value="pending" {% if current_status == 'pending' %}selected{% endif %}>Pending</option>
                            <option value="slot_selected" {% if current_status == 'slot_selected' %}selected{% endif %}>Slot Selected</option>
                            <option value="interviewed" {% if current_status == 'interviewed' %}selected{% endif %}>Interviewed</option>
                            <option value="selected" {% if current_status == 'selected' %}selected{% endif %}>Selected</option>
                            <option value="rejected" {% if current_status == 'rejected' %}selected{% endif %}>Rejected</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-check"></i> Update Status
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Hidden delete form -->
<form id="deleteForm" method="POST" style="display: none;">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
</form>
{% endblock %}

{% block extra_js %}
<script>
function confirmDelete(userId, name, email) {
    if (confirm(`Are you sure you want to delete candidate:\n\n${name}\n${email}\n\nThis action cannot be undone and will redirect you to the candidates list!`)) {
        const form = document.getElementById('deleteForm');
        form.action = `/admin/candidate/${userId}/delete`;
        form.submit();
    }
}
</script>
{% endblock %}
